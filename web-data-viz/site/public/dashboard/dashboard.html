<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareTech</title>

    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/base.css">

    <link rel="stylesheet" href="../css/modais/modalDeslogar.css">
    <link rel="stylesheet" href="../css/modais/modalDashboard.css">


    <link rel="icon" href="../assets/icon/icon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">




    <script src="../js/scriptDash.js" defer></script>
    <script src="../js/modais/modalDeslogar.js" defer></script>



</head>

<body>

    <div class="container-global">
        <div class="box-menu">
            <div class="logomarca">
                <img src="../assets/imgs/logoBrancoDash.png" alt="logoCareTech">
            </div>

            <div class="container-menu">
                <div class="content-menu">
                    <nav class="menu">
                        <ul>
                            <li class="item-menu">
                                <div class="caixa-cor">
                                    <a href="..\dashboard\dashboardVo.html">
                                        <span class="icon"><i class="bi bi-columns-gap"></i></span>
                                        <span class="txt-link">Visão geral</span>
                                    </a>
                                </div>
                            </li>
                            <li class="item-menu">
                                <div class="caixa-cor-aqui">
                                    <a href="..\dashboard\dashboard.html">
                                        <span class="icon"><i class="bi bi-graph-up"></i></span>
                                        <span class="txt-link-aqui">Visão detalhada</span>
                                    </a>
                                </div>
                            </li>
                            <li class="item-menu">
                                <div class="caixa-cor">
                                    <a href="..\dashboard\usuarios.html">
                                        <span class="icon"><i class="bi bi-person-fill"></i></span>
                                        <span class="txt-link">Usuários</span>
                                    </a>
                                </div>
                            </li>
                            <li class="item-menu">
                                <div class="caixa-cor">
                                    <a href="..\dashboard\bloqueio.html">
                                        <span class="icon"><i class="bi bi-ban"></i></span>
                                        <span class="txt-link">Bloqueio de sites</span>
                                    </a>
                                </div>
                            </li>


                        </ul>

                        <div class="box-deslogar">
                            <div class="item-menu-deslogar" onclick="abrirModalDeslogar()">
                                <span class="icon"><i class="bi bi-box-arrow-right"></i></span>
                                <span class="txt-link">
                                    <span>Deslogar</span>
                                </span>
                            </div>
                        </div>
                    </nav>

                </div>
            </div>
        </div>

        <div class="caixa-container">
            <div class="container">
                <div class="container-superior">
                    <div class="container-esquerda">
                        <div class="container-bread">
                            <div id="breadcrumbs" class="breadcrumbs">
                                <nav>
                                    <ol>
                                        <li>
                                            <a href="dashboardVo.html">VISÃO GERAL DAS MÁQUINAS</a>
                                        </li>

                                        <li class="atual">
                                            DETALHES POR MÁQUINA
                                        </li>
                                    </ol>
                                </nav>
                            </div>
                        </div>

                        <div class="container-titulo">
                            <div class="titulo-pagina">
                                <span class="titulo">DETALHES POR MÁQUINA</span>
                                <span class="subtitulo">Selecione uma máquina abaixo para mais informações em tempo
                                    real</span>
                            </div>
                        </div>

                        <div class="container-botao">
                            <div class="box-botao">
                                <div class="fundo-botao" id="botaoGerenciar">
                                    <div class="flexbotao">
                                        <span class="icon"><i class="bi bi-plus-circle"></i></span>
                                        <span>GERENCIAR MÁQUINAS</span>
                                    </div>
                                </div>
                            </div>
                            <div class="box-botao-filtro" id="botaoFiltro" onclick="abrirFiltro()">
                                <div class="fundo-botao-filtro">
                                    <div class="flex-filter">
                                        <span class="icon"><i class="bi bi-funnel"></i></span>
                                        <span class="textfilter">FILTRO</span>
                                    </div>
                                </div>
                                <div class="container-filtro">
                                    <div class="fundo-filtro" id="filtro">
                                        <div class="box-do-filtro">
                                            <span>FILTRAR POR</span>
                                        </div>

                                        <div class="opcoes-filtro">

                                            <div class="titulofilter">
                                                <div class="caixafilter">
                                                    <span style="font-weight: 600;">Status</span>
                                                </div>
                                            </div>

                                            <div class="checkboxfilters">
                                                <div class="caixacheckbox">
                                                    <div class="checkbox-wrapper-18">
                                                        <div class="round">
                                                            <input type="checkbox" id="checkbox-critico" />
                                                            <label for="checkbox-critico"></label> <span> Crítico
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="checkbox-wrapper-18">
                                                        <div class="round">
                                                            <input type="checkbox" id="checkbox-atencao" />
                                                            <label for="checkbox-atencao"></label> <span> Atenção
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="checkbox-wrapper-18">
                                                        <div class="round">
                                                            <input type="checkbox" id="checkbox-ideal" />
                                                            <label for="checkbox-ideal"></label> <span> Ideal </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div style="display: flex; flex-direction: column">
                                                <div class="titulofilter">
                                                    <div class="caixafilter">
                                                        <span style="font-weight: 600;">Condição</span>
                                                    </div>
                                                </div>

                                                <div class="checkboxfilters">
                                                    <div class="caixacheckbox">
                                                        <div class="checkbox-wrapper-18">
                                                            <div class="round">
                                                                <input type="checkbox" id="checkbox-ligado" />
                                                                <label for="checkbox-ligado"></label> <span> Ligado
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="checkbox-wrapper-18">
                                                            <div class="round">
                                                                <input type="checkbox" id="checkbox-desligado" />
                                                                <label for="checkbox-desligado"></label> <span>
                                                                    Desligado </span>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="container-botoes-filtro">
                                            <div class="botao-confirmar">
                                                <div class="conteudo-botao-confirmar">
                                                    <span>
                                                        APLICAR
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>


                    <div class="container-legendas">
                        <div class="content-legenda">
                            <div class="box-legenda">
                                <div class="titulo-legendas">
                                    <span>LEGENDAS:</span>
                                </div>

                                <div class="conteudo-legenda">
                                    <div class="fundo-legenda-status">
                                        <div class="legenda-status1">
                                            <div class="icon-status">
                                                <img src="../assets/imgs/x.png">
                                            </div>
                                            <span>Crítico</span>
                                        </div>
                                        <div class="legenda-status2">
                                            <div class="icon-status">
                                                <img src="../assets/imgs/alerta.png">
                                            </div>
                                            <span>Alerta</span>
                                        </div>
                                        <div class="legenda-status3">
                                            <div class="icon-status">
                                                <img src="../assets/imgs/check.png">
                                            </div>
                                            <span>Ideal</span>
                                        </div>
                                    </div>

                                    <div class="fundo-legenda-condicao">
                                        <div class="legenda-status1">
                                            <div class="icon-status">
                                                <img src="../assets/imgs/ligado.png">
                                            </div>
                                            <span>Ligado</span>
                                        </div>
                                        <div class="legenda-status2">
                                            <div class="icon-status">
                                                <img src="../assets/imgs/off.png">
                                            </div>
                                            <span>Desligado</span>
                                        </div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="container-inferior">
                    <div class="box-maquinas">
                        <div class="background-maquinas" id="background_maquinas">
                            <!-- conteudo das maquinas abaixo -->
                            <!-- <div class="container-maquinas">
                                <div class="coluna-maquinas">
                                    <div class="caixa-maquina">
                                        <div class="box-icon-maquina">
                                            <div class="imagem-maquina">
                                                <img src="../assets/imgs/pngMaquina.png">
                                            </div>
                                        </div>
                                        <div class="box-info-maquina">
                                            <div class="caixadotitulo">
                                                <span class="patrimonio-titulo">bp562801</span>
                                            </div>
                                            <div class="box-informacoes">
                                                <div class="caixa-status">
                                                    <img class="imagemstatus" src="../assets/imgs/alerta.png">
                                                    <span><b>Status: </b></span> <span id="status">Alerta </span>
                                                </div>
                                                <div class="caixa-condicao">
                                                    <img class="imagemcondicao" src="../assets/imgs/ligado.png">
                                                    <span><b>Condição: </b></span> <span id="condicao">Ligada </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> -->




                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

<div class="modalDeslogar" id="deslogarModal">
    <div class="modal-content-deslogar">
        <span class="closeDeslogar">&times;</span>

        <div class="modal-titulo-deslogar">
            <span> <i class="bi bi-box-arrow-right"></i></span>
            <h2>DESLOGAR DA CONTA</h2>
        </div>

        <div class="modal-mensagem-deslogar">
            <p>Tem certeza que deseja encerrar sua sessão?</p>
        </div>

        <div class="modal-botao-deslogar">
            <button id="confirmarDeslogar"> <a href="../login.html">DESLOGAR SESSÃO</a></button>
        </div>
    </div>
</div>


<div id="gerenciarModal" class="modal">
    |<div class="box-centralizar-modal">
        <div class="modal-content">
            <span class="close closeDeslogar">&times;</span>
            <div class="content">
                <div class="icon-cadastrar">
                    <img src="..\assets\imgs\pngMaquina.png">
                </div>

                <div class="titulo-cadastrar">
                    <span>CADASTRO DE MÁQUINAS</span>
                </div>

            </div>
            <div class="box">
                <div class="container-botao-modal">
                    <div class="box-botao-criar">
                        <div class="fundo-botao-criar">
                            <span>CRIAR NOVA MÁQUINA</span>
                        </div>
                    </div>

                    <div class="box-botao-gerenciar">
                        <div class="fundo-botao-gerenciar" id="sessaoGerenciarMaquinas">
                            <span>GERENCIAR MÁQUINA</span>
                        </div>
                    </div>

                </div>
            </div>
            <div class="container-modal">

                <div id="telaCriar" style="display:block;" class="container-inputs-criar">
                    <div class="box-inputs">
                        <div class="boxCriar">
                            <div class="input-group">
                                <label for="localizacao">Estação de trabalho:</label>
                                <input type="text" id="estacao_de_trabalho">
                            </div>
                            <div class="input-group">
                                <label for="login">Login:</label>
                                <input type="text" id="login">
                            </div>
                            <div class="input-group">
                                <label for="senha">Senha:</label>
                                <input type="password" id="senha">
                            </div>
                            <div class="input-group">
                                <label for="senha">Confirmar senha:</label>
                                <input type="password" id="repetir_senha">
                            </div>


                            <div class="modal-botao-cadastrar">
                                <button id="confirmCadastrar"> <a>CADASTRAR</a></button>
                            </div>
                        </div>

                    </div>
                </div>


                <div id="telaGerenciar" style="display:none;" class="container-inputs-gerenciar">
                    <!-- tela de gerenciamento -->

                    <div class="boxGerenciar">
                        <div class="caixa-buscar">
                            <div class="wrap">
                                <div class="search">
                                    <input type="text" class="searchTerm" placeholder="Buscar por localização">
                                    <button type="submit" class="searchButton">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="container-gerenciar" id="lista_computadores">
                            <div>
                                <div>
                                    <div class="box-localizacao">
                                        <span>LOCALIZAÇÃO</span>
                                    </div>

                                    <div class="caixa-gerenciar-cadastrados">
                                        <div class="fundo-gerenciar">
                                            <div class="linha-localizacao">
                                                <span>Mesa 01</span>
                                            </div>
                                            <div class="opcoes-usuario">
                                                <span class="delete-user" data-target="#deleteModal"><i
                                                        class="bi bi-trash3"></i></i></span>
                                                <span class="edit-user" data-target="#editModal"><i
                                                        class="bi bi-pencil-square"></i></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

</html>

<script>
    buscarMaquinas();

    // Selecionando os elementos relevantes
    const telaCriar = document.getElementById('telaCriar');
    const telaGerenciar = document.getElementById('telaGerenciar');
    const botaoCriar = document.querySelector('.box-botao-criar');
    const botaoGerenciar = document.querySelector('.box-botao-gerenciar');
    const btnCriarMaquina = document.getElementById('confirmCadastrar');

    // Adicionando eventos de clique aos botões
    botaoCriar.addEventListener('click', function () {
        // Esconder a tela de gerenciamento e mostrar a tela de criação
        telaGerenciar.style.display = 'none';
        telaCriar.style.display = 'block';
    });

    botaoGerenciar.addEventListener('click', function () {
        // Esconder a tela de criação e mostrar a tela de gerenciamento
        telaCriar.style.display = 'none';
        telaGerenciar.style.display = 'block';
    });

    var checkboxes = document.querySelectorAll('.container-checkbox input[type=checkbox]');
    var filtro = document.getElementById('filtro');

    checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('click', function (event) {
            event.stopPropagation();
        });
    });

    filtro.addEventListener('click', function (event) {
        event.stopPropagation();
    });

    //Buscar máquinas
    let qtdComputadores = 0;

    function buscarMaquinas(){
        fetch(`/dashboard/buscarMaquinas/${sessionStorage.FK_EMPRESA}`, { cache: 'no-store' }).then(function (resposta) {
            if(resposta.ok){
                const computadorLista = document.getElementById('lista_computadores');
                const computadorQuadro = document.getElementById('background_maquinas');

                resposta.json().then(function (resposta){
                    for(;qtdComputadores < resposta.length; qtdComputadores++){    
                        const computador = resposta[qtdComputadores];
                        
                        computadorLista.innerHTML += `
                            <div>
                                <div>
                                    <div class="box-localizacao">
                                        <span>LOCALIZAÇÃO</span>
                                    </div>

                                    <div class="caixa-gerenciar-cadastrados">
                                        <div class="fundo-gerenciar">
                                            <div class="linha-localizacao">
                                                <span>${computador.estacao_de_trabalho}</span>
                                            </div>
                                            <div class="opcoes-usuario">
                                                <span class="delete-user" onclick="deletarComputador(${computador.id_computador})" data-target="#deleteModal"><i
                                                        class="bi bi-trash3"></i></i></span>
                                                <span class="edit-user" onclick="modalDelete(${computador.id_computador})" data-target="#editModal"><i
                                                        class="bi bi-pencil-square"></i></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`;

                            computadorQuadro.innerHTML += `
                            <div class="container-maquinas">
                                <div class="coluna-maquinas">
                                    <div class="caixa-maquina">
                                        <div class="box-icon-maquina">
                                            <div class="imagem-maquina">
                                                <img src="../assets/imgs/pngMaquina.png">
                                            </div>
                                        </div>
                                        <div class="box-info-maquina">
                                            <div class="caixadotitulo">
                                                <span class="patrimonio-titulo">${computador.estacao_de_trabalho}</span>
                                            </div>
                                            <div class="box-informacoes">
                                                <div class="caixa-status">
                                                    <img class="imagemstatus" src="../assets/imgs/alerta.png">
                                                    <span><b>Status: </b></span> <span id="status">Alerta </span>
                                                </div>
                                                <div class="caixa-condicao">
                                                    <img class="imagemcondicao" src="../assets/imgs/ligado.png">
                                                    <span><b>Condição: </b></span> <span id="condicao">Ligada </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            `;
                        }
                    });
                }
            });
        }
        
    //Inserir máquina 

    btnCriarMaquina.addEventListener('click', function () {
        const qtdComputadoesPlano = sessionStorage.QTD_COMPUTADORES_PLANO;
        const estacaoDeTrabalho = document.getElementById('estacao_de_trabalho').value;
        const login = document.getElementById('login').value;
        const senha = document.getElementById('senha').value;
        const repetirSenha = document.getElementById('repetir_senha').value;

        let validacoesCorretas = 3;

        if (senha.length >= 8) {
            validacoesCorretas--;
        }

        if (senha == repetirSenha) {
            validacoesCorretas--;
        }

        if (qtdComputadoesPlano >= qtdComputadores) {
            validacoesCorretas--;
        }

        if (validacoesCorretas == 0) {

        fetch("/dashboard/inserirMaquina", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                estacao_de_trabalho: estacaoDeTrabalho,
                login: login,
                senha: senha,
                fkEmpresa: sessionStorage.FK_EMPRESA
            }),
            }).then( function (resposta) {
                if(resposta.ok){
                    window.location = "/dashboard/dashboard";
                }
            }).catch(function (resposta){
                console.log(`#ERRO: ${resposta}`);
            });
        }
    });

    //Deletar computador
    function deletarComputador(idComputador){
        fetch(`/dashboard/deletarComputador/${idComputador}`, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta){
            if (resposta.ok){
                window.location = "/dashboard/dashboard";
            } else if (resposta.status == 404){
                console.log("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        })
    }
</script>