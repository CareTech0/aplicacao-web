<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareTech</title>

    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="../css/base.css">

    <link rel="stylesheet" href="../css/modais/modalDeslogar.css">
    <link rel="stylesheet" href="../css/modais/modalDashboard.css">


    <link rel="icon" href="../assets/icon/icon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">




    <script src="../js/scriptDash.js" defer></script>
    <script src="../js/modais/modalDeslogar.js" defer></script>
    <script src="../js/session.js"></script>


</head>

<body>

    <div class="container-global">
        <div class="box-menu">
            <div class="logomarca">
                <img src="../assets/imgs/logoBrancoDash.png" alt="logoCareTech">
            </div>

            <div class="container-menu">
                <div class="content-menu">
                    <nav class="menu">
                        <ul>
                            <li class="item-menu">
                                <div class="caixa-cor">
                                    <a href="..\dashboard\dashboardVo.html">
                                        <span class="icon"><i class="bi bi-columns-gap"></i></span>
                                        <span class="txt-link">Visão geral</span>
                                    </a>
                                </div>
                            </li>
                            <li class="item-menu">
                                <div class="caixa-cor-aqui">
                                    <a href="..\dashboard\dashboard.html">
                                        <span class="icon"><i class="bi bi-graph-up"></i></span>
                                        <span class="txt-link-aqui">Visão detalhada</span>
                                    </a>
                                </div>
                            </li>
                            <li class="item-menu">
                                <div class="caixa-cor">
                                    <a href="..\dashboard\usuarios.html">
                                        <span class="icon"><i class="bi bi-person-fill"></i></span>
                                        <span class="txt-link">Usuários</span>
                                    </a>
                                </div>
                            </li>
                            <li class="item-menu">
                                <div class="caixa-cor">
                                    <a href="..\dashboard\bloqueio.html">
                                        <span class="icon"><i class="bi bi-ban"></i></span>
                                        <span class="txt-link">Bloqueio de sites</span>
                                    </a>
                                </div>
                            </li>


                        </ul>

                        <div class="box-deslogar">
                            <div class="item-menu-deslogar" onclick="abrirModalDeslogar()">
                                <span class="icon"><i class="bi bi-box-arrow-right"></i></span>
                                <span class="txt-link">
                                    <span>Deslogar</span>
                                </span>
                            </div>
                        </div>
                    </nav>

                </div>
            </div>
        </div>

        <div class="caixa-container">
            <div class="container">
                <div class="container-superior">
                    <div class="container-esquerda">
                        <div class="container-bread">
                            <div id="breadcrumbs" class="breadcrumbs">
                                <nav>
                                    <ol>
                                        <li>
                                            <a href="dashboardVo.html">VISÃO GERAL DAS MÁQUINAS</a>
                                        </li>

                                        <li class="atual">
                                            DETALHES POR MÁQUINA
                                        </li>
                                    </ol>
                                </nav>
                            </div>
                        </div>

                        <div class="container-titulo">
                            <div class="titulo-pagina">
                                <span class="titulo">DETALHES POR MÁQUINA</span>
                                <span class="subtitulo">Selecione uma máquina abaixo para mais informações em tempo
                                    real</span>
                            </div>
                        </div>

                        <div class="container-botao">
                            <div class="box-botao">
                                <div class="fundo-botao" id="botaoGerenciar">
                                    <div class="flexbotao">
                                        <span class="icon"><i class="bi bi-plus-circle"></i></span>
                                        <span>GERENCIAR MÁQUINAS</span>
                                    </div>
                                </div>
                            </div>
                            <div class="box-botao-filtro" id="botaoFiltro" onclick="abrirFiltro()">
                                <!-- <div class="fundo-botao-filtro">
                                    <div class="flex-filter">
                                        <span class="icon"><i class="bi bi-funnel"></i></span>
                                        <span class="textfilter">FILTRO</span>
                                    </div>
                                </div> -->
                                <div class="container-filtro">
                                    <div class="fundo-filtro" id="filtro">
                                        <div class="box-do-filtro">
                                            <span>FILTRAR POR</span>
                                        </div>

                                        <div class="opcoes-filtro">

                                            <div class="titulofilter">
                                                <div class="caixafilter">
                                                    <span style="font-weight: 600;">Status</span>
                                                </div>
                                            </div>

                                            <div class="checkboxfilters">
                                                <div class="caixacheckbox">
                                                    <div class="checkbox-wrapper-18">
                                                        <div class="round">
                                                            <input type="checkbox" id="checkbox-critico" />
                                                            <label for="checkbox-critico"></label> <span> Crítico
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="checkbox-wrapper-18">
                                                        <div class="round">
                                                            <input type="checkbox" id="checkbox-atencao" />
                                                            <label for="checkbox-atencao"></label> <span> Atenção
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="checkbox-wrapper-18">
                                                        <div class="round">
                                                            <input type="checkbox" id="checkbox-ideal" />
                                                            <label for="checkbox-ideal"></label> <span> Ideal </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div style="display: flex; flex-direction: column">
                                                <div class="titulofilter">
                                                    <div class="caixafilter">
                                                        <span style="font-weight: 600;">Condição</span>
                                                    </div>
                                                </div>

                                                <div class="checkboxfilters">
                                                    <div class="caixacheckbox">
                                                        <div class="checkbox-wrapper-18">
                                                            <div class="round">
                                                                <input type="checkbox" id="checkbox-ligado" />
                                                                <label for="checkbox-ligado"></label> <span> Ligado
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="checkbox-wrapper-18">
                                                            <div class="round">
                                                                <input type="checkbox" id="checkbox-desligado" />
                                                                <label for="checkbox-desligado"></label> <span>
                                                                    Desligado </span>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="container-botoes-filtro">
                                            <div class="botao-confirmar">
                                                <div class="conteudo-botao-confirmar">
                                                    <span>
                                                        APLICAR
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>


                    <div class="container-legendas">
                        <div class="content-legenda">
                            <div class="box-legenda">
                                <div class="titulo-legendas">
                                    <span>LEGENDAS:</span>
                                </div>

                                <div class="conteudo-legenda">
                                    <div class="fundo-legenda-status">
                                        <div class="legenda-status1">
                                            <div class="icon-status">
                                                <img src="../assets/imgs/x.png">
                                            </div>
                                            <span>Crítico</span>
                                        </div>
                                        <div class="legenda-status2">
                                            <div class="icon-status">
                                                <img src="../assets/imgs/alerta.png">
                                            </div>
                                            <span>Alerta</span>
                                        </div>
                                        <div class="legenda-status3">
                                            <div class="icon-status">
                                                <img src="../assets/imgs/check.png">
                                            </div>
                                            <span>Ideal</span>
                                        </div>
                                    </div>

                                    <div class="fundo-legenda-condicao">
                                        <div class="legenda-status1">
                                            <div class="icon-status">
                                                <img src="../assets/imgs/ligado.png">
                                            </div>
                                            <span>Ligado</span>
                                        </div>
                                        <div class="legenda-status2">
                                            <div class="icon-status">
                                                <img src="../assets/imgs/off.png">
                                            </div>
                                            <span>Desligado</span>
                                        </div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="container-inferior">
                    <div class="box-maquinas">
                        <div class="background-maquinas" id="background_maquinas">
                            <!-- conteudo das maquinas abaixo -->

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

<div class="modalDeslogar" id="deslogarModal">
    <div class="modal-content-deslogar">
        <span class="closeDeslogar">&times;</span>

        <div class="modal-titulo-deslogar">
            <span> <i class="bi bi-box-arrow-right"></i></span>
            <h2>DESLOGAR DA CONTA</h2>
        </div>

        <div class="modal-mensagem-deslogar">
            <p>Tem certeza que deseja encerrar sua sessão?</p>
        </div>

        <div class="modal-botao-deslogar">
            <button id="confirmarDeslogar"> <a onclick="sairConta()">DESLOGAR SESSÃO</a></button>
        </div>
    </div>
</div>


<div id="gerenciarModal" class="modal">
    |<div class="box-centralizar-modal">
        <div class="modal-content">
            <span class="close closeDeslogar">&times;</span>
            <div class="content">
                <div class="icon-cadastrar">
                    <img src="..\assets\imgs\pngMaquina.png">
                </div>

                <div class="titulo-cadastrar">
                    <span>CADASTRO DE MÁQUINAS</span>
                </div>

            </div>
            <div class="box">
                <div class="container-botao-modal">
                    <div class="box-botao-criar">
                        <div class="fundo-botao-criar">
                            <span>CRIAR NOVA MÁQUINA</span>
                        </div>
                    </div>

                    <div class="box-botao-gerenciar">
                        <div class="fundo-botao-gerenciar" id="sessaoGerenciarMaquinas">
                            <span>GERENCIAR MÁQUINA</span>
                        </div>
                    </div>

                </div>
            </div>
            <div class="container-modal">

                <div id="telaCriar" style="display:block;" class="container-inputs-criar">
                    <div class="box-inputs">
                        <div class="boxCriar">
                            <div class="input-group">
                                <label for="localizacao">Estação de trabalho:</label>
                                <input type="text" id="estacao_de_trabalho">
                            </div>
                            <div class="input-group">
                                <label for="login">Login:</label>
                                <input type="text" id="login">
                            </div>
                            <div class="input-group">
                                <label for="senha">Senha:</label>
                                <input type="password" id="senha">
                            </div>
                            <div class="input-group">
                                <label for="senha">Confirmar senha:</label>
                                <input type="password" id="repetir_senha">
                            </div>

                           <div id="msgErro" style="color: red; font-size: 14px;">
                           </div>
                           
                            <div class="modal-botao-cadastrar">
                                <button id="confirmCadastrar"> <a>CADASTRAR</a></button>
                            </div>
                        </div>

                    </div>
                </div>

                <div id="telaGerenciar" style="display:none;" class="container-inputs-gerenciar">
                    <!-- tela de gerenciamento -->

                    <div class="boxGerenciar">
                        <div class="caixa-buscar">
                            <div class="wrap">
                                <div class="search">
                                    <input type="text" class="searchTerm" placeholder="Buscar por localização"  id="searchInput">
                                    <button type="submit" class="searchButton" onclick="filtrarMaqs()">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="container-gerenciar" id="lista_computadores">
                            <div>
                                <div class="box-localizacao">
                                    <span>LOCALIZAÇÃO</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="editar_modal" style="display: none;" class="container-inputs-criar">
                    <!-- Tela de edição da máquina -->
                </div>
            </div>
        </div>

    </div>
</div>
</div>

</html>

<script>
    validarSessao()
    buscarMaquinas();

    // Selecionando os elementos relevantes
    const telaCriar = document.getElementById('telaCriar');
    const telaEditar = document.getElementById('editar_modal');
    const telaGerenciar = document.getElementById('telaGerenciar');
    const botaoCriar = document.querySelector('.box-botao-criar');
    const botaoGerenciar = document.querySelector('.box-botao-gerenciar');
    const btnCriarMaquina = document.getElementById('confirmCadastrar');

    // Adicionando eventos de clique aos botões
    botaoCriar.addEventListener('click', function () {
        // Esconder a tela de gerenciamento e mostrar a tela de criação
        telaGerenciar.style.display = 'none';
        telaCriar.style.display = 'block';
        telaEditar.style.display = 'none';
    });

    botaoGerenciar.addEventListener('click', function () {
        // Esconder a tela de criação e mostrar a tela de gerenciamento
        telaCriar.style.display = 'none';
        telaEditar.style.display = 'none';
        telaGerenciar.style.display = 'block';
    });

    var checkboxes = document.querySelectorAll('.container-checkbox input[type=checkbox]');
    var filtro = document.getElementById('filtro');

    checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('click', function (event) {
            event.stopPropagation();
        });
    });

    filtro.addEventListener('click', function (event) {
        event.stopPropagation();
    });

    //Buscar máquinas
    let qtdComputadores = 0;

    //Editar a máquina
    function modalEditarMaquina(idComputador, estacaoDeTrabalho, login, senha){
        telaGerenciar.style.display = "none";
        telaEditar.style.display = "block";
        telaEditar.innerHTML = `
            <div class="box-inputs" style="margin-top: 20px;">
                
                <div class="boxCriarEditar" style="display: flex;align-items: center; flex-direction: column;height: 100%;gap: 6px; width: 96%;">
                    <div style="height: 20px; width: 178px;">
                        <h2 style="font-size: 18px; font-weight:600; ">EDITAR MÁQUINA</h2>
                       </div>

                    <div class="input-group">
                        <label for="estacao_de_trabalho_editar">Estação de trabalho:</label>
                        <input type="text" id="estacao_de_trabalho_editar" value="${estacaoDeTrabalho}">
                    </div>
                    <div class="input-group">
                        <label for="login_editar">Login:</label>
                        <input type="text" id="login_editar" value="${login}">
                    </div>
                    <div class="input-group">
                        <label for="senha_editar">Senha:</label>
                        <input type="password" id="senha_editar" value="${senha}">
                    </div>
                    <div class="input-group">
                        <label for="repetir_senha_editar">Confirmar senha:</label>
                        <input type="password" id="repetir_senha_editar" value="${senha}">
                    </div>

                    <div id="msgErroEdit" style="color: red; font-size: 14px;">
                    </div>
                    

                    <div class="modal-botao-cadastrar">
                        <button onclick="editarComputador(${idComputador})"> <a>EDITAR</a></button>
                    </div>
                </div>

            </div>
        `;
    }

    function editarComputador(id){
        const estacaoDeTrabalho = document.getElementById('estacao_de_trabalho_editar').value;
        const login = document.getElementById('login_editar').value;
        const senha = document.getElementById('senha_editar').value;
        const repetirSenha = document.getElementById('repetir_senha_editar').value;

        

        const msgErro = document.getElementById('msgErroEdit');

        const qtdComputadores = 1; 
    
        let validacoesCorretas = 0;
        let mensagemErro = "";

        console.log("começando a validação"); 

    
        if (senha.length < 8) {
            mensagemErro += `<span>A senha deve ter no mínimo 8 caracteres.</span><br>`;
            console.log("erro na validação da senha"); 
        } else {
            validacoesCorretas++;
        }
    
        if (senha !== repetirSenha) {
            mensagemErro += `<span>As senhas não coincidem.</span><br>`;
            console.log("erro na confirmação da senha");
        } else {
            validacoesCorretas++;
        }

        if (estacaoDeTrabalho.length == "") {
            mensagemErro += `<span>É necessário nomear a estação de trabalho.</span><br>`;
            console.log("erro na validação da senha"); 
        } else {
            validacoesCorretas++;
        }

        console.log(`validacoesCorretas: ${validacoesCorretas}`);
        console.log(`mensagemErro: ${mensagemErro}`);

        msgErroEdit.innerHTML = mensagemErro;
        

        if (validacoesCorretas == 3) {
            fetch(`/dashboard/editarMaquina/${id}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    estacaoDeTrabalho: estacaoDeTrabalho,
                    login: login,
                    senha: senha,
                }),
            })
            .then( function (resposta) {
                if(resposta.ok){
                    window.location = "/dashboard/dashboard";
                }
            }).catch(function (resposta){
                console.log(`#ERRO: ${resposta}`);
            });
        }
    }

    setInterval(()=> {
        fetch(`/dashboard/buscarDadosDaMaquina/${sessionStorage.FK_EMPRESA}`, {cache: 'no-store'}).then(function (resposta){
            if(resposta.ok){
                resposta.json().then(function (resposta){
                    todasMaquinas.forEach(maquina => {
                        const condicao = document.getElementById(`condicao${maquina.id_computador}`);
                        const status = document.getElementById(`status${maquina.id_computador}`);
                        const imgCondicao = document.getElementById(`imgCondicao${maquina.id_computador}`);
                        const imgStatus = document.getElementById(`imgStatus${maquina.id_computador}`);
                      
                        let dadosCpu = 0;
                        let dadosRam = 0;
                        let dadosDisco = 0;

                        resposta.forEach(dadosMaquina => {
                            const fkComputador = dadosMaquina.fk_computador[0];
                            if(fkComputador == maquina.id_computador){
                                condicao.innerText = "Ligada";
                                imgCondicao.src = "../assets/imgs/ligado.png";

                                const agora = new Date();
                                const cincoMinutosAtras = new Date(agora.getTime() - 300000);
                                const horarioMaquina = new Date(dadosMaquina.horario);

                                
                                if(dadosMaquina.nome_hardware != "rede"){
                                    if(horarioMaquina >= cincoMinutosAtras && horarioMaquina <= agora){


                                        if(dadosMaquina.nome_hardware == "disco") dadosDisco = (dadosMaquina.uso_capacidade * 100) / dadosMaquina.capacidade_total;
                                        if(dadosMaquina.nome_hardware == "ram") dadosRam = (dadosMaquina.uso_capacidade * 100) / dadosMaquina.capacidade_total;
                                        if(dadosMaquina.nome_hardware == "cpu") dadosCpu = dadosMaquina.uso_capacidade;

                                        if(maquina.estacao_de_trabalho == 'ESTAÇÃO AMANDA'){
                                            console.log(`
                                                ${dadosDisco}
                                                ${dadosCpu}
                                                ${dadosRam}
                                            `)
                                        }

                                        if(dadosCpu > 80 && dadosCpu <= 90 || dadosDisco > 80 && dadosDisco <= 90 || dadosRam > 80 && dadosRam <= 90){
                                            status.innerText = "Alerta";
                                            imgStatus.src = "../assets/imgs/alerta.png";

                                        } else if(dadosCpu > 90 || dadosDisco > 90 || dadosRam > 90){
                                            status.innerText = "Crítico";
                                            imgStatus.src = "../assets/imgs/x.png";

                                        } else {
                                            status.innerText = "Ideal";
                                            imgStatus.src = "../assets/imgs/check.png";
                                        }
                                    } else {
                                        status.innerText = "---";
                                        imgStatus.src = "../assets/imgs/x.png";
                                        condicao.innerText = "Desligada";
                                        imgCondicao.src = "../assets/imgs/off.png";
                                    }
                                }
                            } 
                        });
                    })
                }).catch(function (erro) {
                    console.error('Erro ao buscar dados do disco:', erro);
                    const imagemstatus = document.querySelectorAll('.imagemstatus');
                    const imagemcondicao = document.querySelectorAll('.imagemcondicao');
                    const condicoesTot = document.querySelectorAll('.condicoesTot');
                    const statusTot = document.querySelectorAll('.statusTot');

                    imagemcondicao.forEach(imgCondicao => {
                        imgCondicao.src = "../assets/imgs/off.png";
                    });

                    imagemstatus.forEach(imgStatus => {
                        imgStatus.src = "../assets/imgs/x.png"
                    });

                    condicoesTot.forEach(condicoesTotal => {
                        condicoesTotal.innerText="Desligada";
                    })

                    statusTot.forEach(statusTotal => {
                        statusTotal.innerText="---";
                    })

                });
            }
        })
    }, 3000)

    let todasMaquinas = []; // usando no filtro
    function buscarMaquinas(){
        fetch(`/dashboard/buscarMaquinas/${sessionStorage.FK_EMPRESA}`, { cache: 'no-store' }).then(function (resposta) {
            if(resposta.ok){
                const computadorLista = document.getElementById('lista_computadores');
                const computadorQuadro = document.getElementById('background_maquinas');

                resposta.json().then(function (resposta){
                    todasMaquinas = resposta;
                    for(;qtdComputadores < resposta.length; qtdComputadores++){    
                        const computador = resposta[qtdComputadores];
                        
                        computadorLista.innerHTML += `
                            <div>
                                <div>
                                  

                                    <div class="caixa-gerenciar-cadastrados">
                                        <div class="fundo-gerenciar">
                                            <div class="linha-localizacao">
                                                <span>${computador.estacao_de_trabalho.toUpperCase()}</span>
                                            </div>
                                            <div class="opcoes-usuario">
                                                <span class="delete-user" onclick="deletarComputador(${computador.id_computador})" data-target="#deleteModal"><i
                                                        class="bi bi-trash3"></i></i></span>
                                                <span class="edit-user" onclick="modalEditarMaquina(${computador.id_computador}, '${computador.estacao_de_trabalho}', '${computador.login}', '${computador.senha}')" data-target="#editModal"><i
                                                        class="bi bi-pencil-square"></i></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`;

                            computadorQuadro.innerHTML += `
                            <div class="container-maquinas" onclick="detalhesComputador(${computador.id_computador})">
                                <div class="coluna-maquinas">
                                    <div class="caixa-maquina">
                                        <div class="box-icon-maquina">
                                            <div class="imagem-maquina">
                                                <img src="../assets/imgs/pngMaquina.png">
                                            </div>
                                        </div>
                                        <div class="box-info-maquina">
                                            <div class="caixadotitulo">
                                                <span class="patrimonio-titulo">${computador.estacao_de_trabalho.toUpperCase()}</span>
                                            </div>
                                            <div class="box-informacoes">
                                                <div class="caixa-status">
                                                    <img class="imagemstatus" id="imgStatus${computador.id_computador}" src="../assets/imgs/x.png">
                                                    <span><b>Status: </b></span> <span class="statusTot" id="status${computador.id_computador}">--- </span>
                                                </div>
                                                <div class="caixa-condicao">
                                                    <img class="imagemcondicao" id="imgCondicao${computador.id_computador}" src="../assets/imgs/off.png">
                                                    <span><b>Condição: </b></span> <span class="condicoesTot" id="condicao${computador.id_computador}">Desligada </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            `;
                        }
                    });
                }
            });
        }

        function detalhesComputador(idComputador){
            window.location = `/dashboard/dashboardFilha?idComputador=${idComputador}`;
        }

    //Inserir máquina 
    
    function filtrarMaqs() {
        const termoBusca = document.getElementById('searchInput').value.toLowerCase();
        const maquinasFiltradas = todasMaquinas.filter(function (computador) {
            return computador.estacao_de_trabalho.toLowerCase().includes(termoBusca);
        });
        mostrarMaquinas(maquinasFiltradas);
    }
    
    // Adiciona evento de clique ao botão de busca
    document.querySelector('.searchButton').addEventListener('click', filtrarMaqs);

    function mostrarMaquinas(maquinas) {
        const computadorLista = document.getElementById('lista_computadores');
        computadorLista.innerHTML = '';
        maquinas.forEach(function (computador) {
            computadorLista.innerHTML += `
                <div>
                    <div class="caixa-gerenciar-cadastrados">
                        <div class="fundo-gerenciar">
                            <div class="linha-localizacao">
                                <span>${computador.estacao_de_trabalho.toUpperCase()}</span>
                            </div>
                            <div class="opcoes-usuario">
                                <span class="delete-user" onclick="deletarComputador(${computador.id_computador})" data-target="#deleteModal"><i
                                        class="bi bi-trash3"></i></span>
                                <span class="edit-user" onclick="modalEditarMaquina(${computador.id_computador}, '${computador.estacao_de_trabalho}', '${computador.login}', '${computador.senha}')" data-target="#editModal"><i
                                        class="bi bi-pencil-square"></i></span>
                            </div>
                        </div>
                    </div>
                </div>`;
        });
    }

    btnCriarMaquina.addEventListener('click', function () {
        const qtdComputadoesPlano = sessionStorage.QTD_MAQUINAS_PLANO;
        const estacaoDeTrabalho = document.getElementById('estacao_de_trabalho').value;
        const login = document.getElementById('login').value;
        const senha = document.getElementById('senha').value;
        const repetirSenha = document.getElementById('repetir_senha').value;
        const msgErro = document.getElementById('msgErro');

        const qtdComputadores = 1; 
    
        let validacoesCorretas = 0;
        let mensagemErro = "";

        console.log("começando a validação"); 

    
        if (senha.length < 8) {
            mensagemErro += `<span>A senha deve ter no mínimo 8 caracteres.</span><br>`;
            console.log("erro na validação da senha"); 
        } else {
            validacoesCorretas++;
        }
        
        if (estacaoDeTrabalho.length == "") {
            mensagemErro += `<span>É necessário nomear a estação de trabalho.</span><br>`;
            console.log("erro na validação da senha"); 
        } else {
            validacoesCorretas++;
        }
    
        if (senha !== repetirSenha) {
            mensagemErro += `<span>As senhas não coincidem.</span><br>`;
            console.log("erro na confirmação da senha");
        } else {
            validacoesCorretas++;
        }
    
        if (qtdComputadoesPlano < qtdComputadores) {
            mensagemErro += `<span>Número de computadores excede o plano.</span><br>`;
            console.log("erro na validação do plano de computadores"); 

        } else {
            validacoesCorretas++;
        }
    

        console.log(`validacoesCorretas: ${validacoesCorretas}`);
        console.log(`mensagemErro: ${mensagemErro}`);

        msgErro.innerHTML = mensagemErro;
        
        if (validacoesCorretas == 4) {
            msgErro.innerText = ""; // Limpa mensagem de erro se todas as validações passaram
            fetch("/dashboard/inserirMaquina", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    estacao_de_trabalho: estacaoDeTrabalho,
                    login: login,
                    senha: senha,
                    fkEmpresa: sessionStorage.FK_EMPRESA
                }),
            }).then(function (resposta) {
                if (resposta.ok) {
                    window.location = "/dashboard/dashboard";
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
        } 
    });

    //Deletar computador
    function deletarComputador(idComputador){
        fetch(`/dashboard/deletarComputador/${idComputador}`, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta){
            if (resposta.ok){
                window.location = "/dashboard/dashboard";
            } else if (resposta.status == 404){
                console.log("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            window.location = "/dashboard/dashboard";
        })
    }
</script>